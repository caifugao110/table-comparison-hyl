# 📊 Excel销售毛利分析表比较工具

## 📝 项目简介

本工具用于比较两个Excel销售毛利分析表文件，自动标记差异内容，包括数值变化、新增行和删除行，帮助用户快速识别两个版本的销售数据差异。

## 🛠️ 项目依赖

### 外部库
- **openpyxl**: 用于Excel文件的读取、写入和样式设置
  - 安装命令: `pip install openpyxl`

### 标准库
- **os**: 用于文件路径处理和系统操作 📁
- **subprocess**: 用于执行系统命令（设置文件只读属性、打开文件） 💻
- **stat**: 用于文件权限处理 🔒
- **datetime**: 用于生成时间戳，避免结果文件覆盖 ⏰

## 🎨 颜色标记逻辑

### 1. 数值变化 (黄色) 🟡
- **颜色代码**: `FFFF00`
- **应用场景**: 当两个文件中匹配行的相同列值不同时
- **标记方式**: 同时标记基准文件和比较文件中的差异单元格
- **处理逻辑**: 
  - 基于关键字段（部门、合同号、产品代码）匹配行
  - 比较匹配行中对应列的值
  - 只比较数据列，跳过关键字段列

### 2. 新增行 (绿色) 🟢
- **颜色代码**: `00FF00`
- **应用场景**: 比较文件中有但基准文件中没有的行
- **标记方式**: 整行标记为绿色
- **处理逻辑**: 
  - 基于关键字段查找比较文件中独有的行
  - 标记整行为绿色

### 3. 删除行 (红色) 🔴
- **颜色代码**: `FF0000`
- **应用场景**: 基准文件中有但比较文件中没有的行
- **标记方式**: 整行标记为红色
- **处理逻辑**: 
  - 基于关键字段查找基准文件中独有的行
  - 标记整行为红色

## 🔄 工作流程

1. **文件加载** 📂: 加载基准文件和比较文件
2. **工作表选择** 📋: 
   - 如果两个文件都只有一个工作表，直接使用
   - 否则提示用户选择要比较的工作表
3. **关键字段匹配** 🔑: 
   - 从第三行查找关键字段（部门、合同号、产品代码）
   - 基于关键字段建立行映射关系
   - 如果无法找到关键字段，使用默认行匹配
4. **差异比较** 🔍: 
   - 比较匹配行的对应列值
   - 标记数值变化的单元格
5. **新增/删除行标记** ➕➖: 
   - 标记比较文件中的新增行
   - 标记基准文件中的删除行
6. **结果保存** 💾: 
   - 将带颜色标记的结果保存到results文件夹
   - 设置结果文件为只读属性
7. **自动打开** 📤: 自动打开生成的结果文件

## 🚀 使用方法

### 配置文件路径 ⚙️

在脚本的 `if __name__ == "__main__":` 部分配置以下参数：

```python
# 基准文件路径（my文件夹）
baseline_file = "my\\销售毛利分析表.xlsx"

# 比较文件路径（from文件夹）
compare_file = "from\\销售毛利分析表.xlsx"

# 结果文件保存目录
results_folder = "results"
```

### 运行脚本 ▶️

```bash
python compare_excel_销售毛利分析表.py
```

## 📋 结果文件

- 结果文件保存到 `results` 文件夹 📁
- 文件名格式: `销售毛利分析表_<文件夹名>_比较结果_<时间戳>.xlsx`
- 结果文件默认设置为只读属性 🔒
- 运行完成后自动打开结果文件 📤

## 📁 项目结构

```
table-comparison-hyl/
├── my/                      # 基准文件目录 📁
│   └── 销售毛利分析表.xlsx   # 基准销售毛利分析表 📊
├── from/                    # 比较文件目录 📁
│   └── 销售毛利分析表.xlsx   # 比较销售毛利分析表 📊
├── results/                 # 结果文件输出目录 📁
├── compare_excel_销售毛利分析表.py  # 主程序文件 🐍
└── README.md               # 项目说明文档 📖
```

## ⚠️ 注意事项

1. **关键字段**: 确保销售毛利分析表的第三行包含关键字段（部门、合同号、产品代码） 🔑
2. **文件格式**: 仅支持 `.xlsx` 格式的Excel文件 📊
3. **公式处理**: 读取文件时仅加载数据，不加载公式 📈
4. **结果文件**: 自动生成带时间戳的结果文件，避免覆盖现有文件 ⏰
5. **只读属性**: 结果文件默认设置为只读，防止误修改 🔒

## 📌 扩展说明

本工具可用于比较其他类型的Excel表格，只需调整关键字段和文件路径配置。核心比较逻辑基于行匹配和列匹配，具有良好的通用性和可扩展性。🚀